<div x-cloak x-data="{ lvl1: false, lvl2: false, lvl3: false }" class="nav-level-1 p-4 h-screen overflow-scroll overscroll-contain">
    <div class="flex flex-col mx-4">
        {{ nav :handle="nav_title" }}
            {{ lvl1_parent = title | slugify }}
            {{ if url && children }}
                <a href="{{ url }}"
                    {{if current_uri | contains(url) }}@click.prevent="lvl1 = (lvl1 === '{{title | slugify}}') ? '' : '{{title | slugify}}'" {{/if}}
                    class="no-underline nav-button text-left text-[.875rem] my-0 pl-2 py-2 hover:text-amp-blue-500 {{if is_current }} text-amp-blue-500 active{{else}}text-amp-gray-600{{/if}}"
                    {{if is_current }} x-effect="lvl1 = '{{title | slugify}}'"{{/if}} :class="lvl1 === '{{ title | slugify }}' ? 'active' : ''">{{ title }} <!--{{current_uri}} - {{url}} -->
                    {{ svg src="/assets/general/icon-chevron-down.svg" class="inline absolute right-4" }}</a>
            {{ elseif url }}
                {{ navigation_icon }}<a href="{{ url }}"
                    class="no-underline block text-[.875rem] p-2 leading-5 hover:bg-amp-gray-50 hover:rounded {{if is_current }}bg-amp-blue-950 text-amp-blue-500 rounded active{{else}}text-amp-gray-600{{/if}}">{{ title }}</a>
            {{ else }}
                <button @click.prevent="lvl1 = (lvl1 === '{{ title | slugify }}') ? '' : '{{ title | slugify }}'"
                    class="nav-button text-left text-[.875rem] my-0 py-[.25rem]"
                    :class="lvl1 === '{{ title | slugify }}' ? 'active' : ''">{{ title }}
                    {{ svg src="/assets/general/icon-chevron-down.svg" class="inline absolute right-4" }}</button>
            {{ /if }}
            {{ if children }}
                <div x-show="lvl1 === '{{ title | slugify }}'" class="nav-level-2 flex flex-col gap-2 my-0 pl-4"
                    x-collapse>
                    {{ children }}
                        {{ if url }}
                            <a href="{{ url }}"
                                class="no-underline block text-[.875rem] p-2 leading-5 hover:bg-amp-gray-50 hover:rounded  {{if is_current}}bg-amp-blue-950 text-amp-blue-500 rounded active{{else}}text-amp-gray-600{{/if}}"
                                {{if is_current }} x-effect="lvl1 = '{{parent:title | slugify}}'{{/if}}">{{ title }}</a>
                        {{ else }}
                            <button
                                @click.prevent="lvl2 = (lvl2 === '{{ title | slugify }}' ? null : '{{ title | slugify }}')"
                                class="text-left text-[.875rem]"
                                :class="lvl2 === '{{ title | slugify }}' ? 'active' : ''">{{ title }}
                                {{ svg src="/assets/general/icon-chevron-down.svg" class="inline absolute right-4" }}</button>
                        {{ /if }}
                        {{ if children }}
                            <div x-show="lvl2 === '{{ title | slugify }}'" class="nav-level-3 my-0" x-collapse>
                                {{ children }}
                                    <a href="{{ url }}"
                                        class="no-underline block text-[.875rem] p-2 leading-5 hover:bg-amp-gray-50 hover:rounded  {{if is_current}}bg-amp-blue-950 text-amp-blue-500 rounded active{{else}}text-amp-gray-600{{/if}}"
                                        {{if is_current }} x-effect="lvl2 = '{{parent:title | slugify}}'; lvl1 = '{{lvl1_parent}}'"{{/if}}>{{ title }}</a>
                                {{ /children }}
                            </div>
                        {{ /if }}
                    {{ /children }}
                </div>
            {{ /if }}
        {{ /nav }}
    </div>
</div>